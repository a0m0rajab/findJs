<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Data To list.
    </title>
</head>

<body>
    <input id=Next type="button" value="Back" onclick="preSura()">

    <input id=page type="number" min=1 max=114 onchange="setSura(Number(this.value)-1)" onkeyup="setSura(Number(this.value)-1)">
    <input id=Next type="button" value="next" onclick="nextSura()">
    <br>
    <br>
    <input id=searchQue type="text" onkeyup="setSura(Number(this.value)-1)">

    <br>

    <p id=found></p>
    <p id=dataShow></p>
    <script>
        // extend string function : https://stackoverflow.com/questions/8392035/add-method-to-string-class
        String.prototype.indeOfAll = function(word) {
            let index = -1,
                location = [];
            // the loop change the index to loop all the text isntead of stopping when it find it, check indexOf.
            do {
                // return -1 if not found, thats why we pop it at the end, cause it will break the loop
                index = this.indexOf(word, index + 1);

                // add location (if found, otherwise it will be -1 and popped out.)
                location.push(index)
                    // no word found.
            } while (index !== -1);
            // remove the last one.
            location.pop();
            return location

        }

        // to find the word, you can either :
        // find the word from clean text and use the index for the non clean one... or clean the text during your search, to ignore characters add it as parameter on search method.
        // it will be like word, target, ignoreCase.
        // array that hold an array of verses of each sura.
        let sura = [];
        let chars = {
            harakat: {
                kasra: `ِ`
            },
            letters: []
        }
        let lastSura = 0;
        const URL = "https://a0m0rajab.github.io/findJs/"
        const quran = "quran.txt"
        const qurClean = "quran-simple-clean.txt"
        let QurClean = "https://a0m0rajab.github.io/findJs/quran-simple-clean.txt"
        let testURL = "https://a0m0rajab.github.io/findJs/QueryCompletetion/quran.txt"
            // need to add target array to make this global and even add read function at the end.... instead of dataToArray
        function readExternal(url, target, callBack) {
            console.log("reading external data from " + url)
            fetch(url)
                .then(r => r.text()) //response
                .then(t => callBack(t, target)); //text
        }

        function dataToArray(t, targetArray) {
            // split the file to line, which downloaded from Tanzil.
            let lines = t.split("\n");
            console.log("Quran Verses= " + lines.length);
            // temp to hold the number of sura, so we can use it to trigger the next sura and empty the verses array.
            let versesArray = [];
            for (let line of lines) {
                line = line.split("|");
                let suraN = line[0] - 1;
                if (targetArray[suraN] == undefined) {
                    targetArray[suraN] = [];
                }
                targetArray[suraN].push(line[2])
            }
            displaySura(dataShow, sura[0])
        }
        let n = 0;

        function setSura(h = 0) {
            h = Number(h)
                //console.log(h);
            if (h > 113 || h < 0)
                setSur(lastSura)
                // return dataShow.innerText = "Please Choose a number between 1-114"
            lastSura = h
            page.value = h + 1;
            displaySura(dataShow, sura[h])
        }

        function nextSura() {
            n++;
            if (n == 114) {
                n = 0;
            }
            setSura(n)
        }

        function preSura() {
            n--;
            if (n == -1)
                n = 113;
            setSura(n)
        }

        function displaySura(target, arr) {
            let text = "";
            arr.forEach(e => {
                text += e + "\n"
            });
            target.innerText = text;
        }

        function init() {
            page.value = 1;

            readExternal(URL + qurClean, sura, dataToArray);

        }
        // get the sura and verses that has this word.
        function search(word) {
            let index = -1,
                loc = [];
            // loop all of suras.
            for (i = 0; i < sura.length; i++) {
                // loop verses of each sura.
                for (let j = 0; j < sura[i].length; j++) {
                    let locs = sura[i][j].indexOf(word)
                    if (locs !== -1) {
                        loc.push([i, j])
                    }
                }
            }
            return loc;
        }
        init();

        // each harakat is a letter...
    </script>
</body>

</html>